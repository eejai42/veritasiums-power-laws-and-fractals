-- ============================================================================
-- CREATE FUNCTIONS - Calculation functions for lookup/calculated fields
-- ============================================================================
-- Generated by rulebook-to-postgres tool
-- ============================================================================

-- ============================================================================
-- LOOKUP FUNCTIONS
-- These functions perform lookups via foreign key relationships
-- ============================================================================

-- calc_systems_empirical_fit_quality
-- Field: systems.EmpiricalFitQuality
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: R2 from related inference_runs
-- Formula: =INDEX(inference_runs!{{R2}}, MATCH(systems!{{SystemID}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_systems_empirical_fit_quality(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2::numeric FROM inference_runs WHERE inference_run_id = (SELECT system_id FROM systems WHERE system_id = p_system_id));
END;
$$ LANGUAGE plpgsql;

-- calc_systems_empirical_slope_deviation
-- Field: systems.EmpiricalSlopeDeviation
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Lookup: SlopeDelta from related inference_runs
-- Formula: =ABS(INDEX(inference_runs!{{SlopeDelta}}, MATCH(systems!{{SystemID}}, inference_runs!{{System}}, 0)))
CREATE OR REPLACE FUNCTION calc_systems_empirical_slope_deviation(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta::numeric FROM inference_runs WHERE inference_run_id = (SELECT system_id FROM systems WHERE system_id = p_system_id));
END;
$$ LANGUAGE plpgsql;

-- calc_systems_measurement_noise_level
-- Field: systems.MeasurementNoiseLevel
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: NoiseSigma from related measurement_models
-- Formula: =INDEX(measurement_models!{{NoiseSigma}}, MATCH(systems!{{SystemID}}, measurement_models!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_systems_measurement_noise_level(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT noise_sigma::numeric FROM measurement_models WHERE measurement_model_id = (SELECT system_id FROM systems WHERE system_id = p_system_id));
END;
$$ LANGUAGE plpgsql;

-- calc_systems_relative_slope_error
-- Field: systems.RelativeSlopeError
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Lookup: SlopeDelta from related inference_runs
-- Formula: =INDEX(inference_runs!{{SlopeDelta}}, MATCH(systems!{{SystemID}}, inference_runs!{{System}}, 0)) / {{TheoreticalLogLogSlope}}
CREATE OR REPLACE FUNCTION calc_systems_relative_slope_error(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta::numeric FROM inference_runs WHERE inference_run_id = (SELECT system_id FROM systems WHERE system_id = p_system_id));
END;
$$ LANGUAGE plpgsql;

-- calc_systems_scale_range_span
-- Field: systems.ScaleRangeSpan
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: DeltaLogScale from related system_stats
-- Formula: =INDEX(system_stats!{{DeltaLogScale}}, MATCH(systems!{{SystemID}}, system_stats!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_systems_scale_range_span(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN calc_system_stats_delta_log_scale((SELECT system_id FROM systems WHERE system_id = p_system_id));
END;
$$ LANGUAGE plpgsql;

-- calc_systems_measure_range_span
-- Field: systems.MeasureRangeSpan
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: DeltaLogMeasure from related system_stats
-- Formula: =INDEX(system_stats!{{DeltaLogMeasure}}, MATCH(systems!{{SystemID}}, system_stats!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_systems_measure_range_span(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN calc_system_stats_delta_log_measure((SELECT system_id FROM systems WHERE system_id = p_system_id));
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_data_regime
-- Helper function: Get DataRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_data_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_scale_regime
-- Helper function: Get ScaleRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_scale_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT scale_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_type
-- Helper function: Get NoiseType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT noise_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_sigma
-- Helper function: Get NoiseSigma from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_sigma(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT noise_sigma FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_min_scale
-- Helper function: Get CutoffMinScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_min_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_min_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_max_scale
-- Helper function: Get CutoffMaxScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_max_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_max_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_type
-- Helper function: Get DiscretizationType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_param
-- Helper function: Get DiscretizationParam from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_param(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_param FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_analysis_name
-- Helper function: Get AnalysisName from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_analysis_name(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT analysis_name FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_status
-- Helper function: Get Status from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_status(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT status FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_analysis_name
-- Helper function: Get AnalysisName from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_analysis_name(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT analysis_name FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_status
-- Helper function: Get Status from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_status(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT status FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- calc_systems_data_quality_score
-- Field: systems.DataQualityScore
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{EmpiricalFitQuality}} * (1 - {{EmpiricalSlopeDeviation}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{EmpiricalFitQuality}} * (1 - {{EmpiricalSlopeDeviation}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_systems_data_quality_score(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_systems_empirical_fit_quality(p_system_id), 0))::numeric * (COALESCE((1 - calc_systems_empirical_slope_deviation(p_system_id)), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_systems_is_high_quality_fit
-- Field: systems.IsHighQualityFit
-- Type: calculated | DataType: boolean | Returns: BOOLEAN
-- Formula: =AND({{EmpiricalFitQuality}} > 0.99, {{EmpiricalSlopeDeviation}} < 0.05)
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =AND({{EmpiricalFitQuality}} > 0.99, {{EmpiricalSlopeDeviation}} < 0.05)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_systems_is_high_quality_fit(p_system_id TEXT)
RETURNS BOOLEAN AS $$
BEGIN
  RETURN ((calc_systems_empirical_fit_quality(p_system_id) > 0.99 AND calc_systems_empirical_slope_deviation(p_system_id) < 0.05))::text;
END;
$$ LANGUAGE plpgsql;

-- calc_scales_base_scale
-- Field: scales.BaseScale
-- Type: lookup | DataType: integer | Returns: INTEGER
-- Lookup: BaseScale from related systems
-- Formula: =INDEX(systems!{{BaseScale}}, MATCH(scales!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_scales_base_scale(p_scale_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale::integer FROM systems WHERE system_id = (SELECT "system" FROM scales WHERE scale_id = p_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_scales_scale_factor
-- Field: scales.ScaleFactor
-- Type: lookup | DataType: decimal | Returns: NUMERIC
-- Lookup: ScaleFactor from related systems
-- Formula: =INDEX(systems!{{ScaleFactor}}, MATCH(scales!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_scales_scale_factor(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor::numeric FROM systems WHERE system_id = (SELECT "system" FROM scales WHERE scale_id = p_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_scales_theoretical_log_log_slope
-- Field: scales.TheoreticalLogLogSlope
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: TheoreticalLogLogSlope from related systems
-- Formula: =INDEX(systems!{{TheoreticalLogLogSlope}}, MATCH(scales!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_scales_theoretical_log_log_slope(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope::numeric FROM systems WHERE system_id = (SELECT "system" FROM scales WHERE scale_id = p_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_scales_empirical_log_log_slope
-- Field: scales.EmpiricalLogLogSlope
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: EmpiricalLogLogSlope from related system_stats
-- Formula: =INDEX(system_stats!{{EmpiricalLogLogSlope}}, MATCH(scales!{{System}}, system_stats!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_scales_empirical_log_log_slope(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN calc_system_stats_empirical_log_log_slope((SELECT "system" FROM scales WHERE scale_id = p_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_scales_system_min_log_scale
-- Field: scales.SystemMinLogScale
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: MinLogScale from related system_stats
-- Formula: =INDEX(system_stats!{{MinLogScale}}, MATCH(scales!{{System}}, system_stats!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_scales_system_min_log_scale(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN calc_system_stats_min_log_scale((SELECT "system" FROM scales WHERE scale_id = p_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_scales_system_max_log_scale
-- Field: scales.SystemMaxLogScale
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: MaxLogScale from related system_stats
-- Formula: =INDEX(system_stats!{{MaxLogScale}}, MATCH(scales!{{System}}, system_stats!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_scales_system_max_log_scale(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN calc_system_stats_max_log_scale((SELECT "system" FROM scales WHERE scale_id = p_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_scales_system_delta_log_scale
-- Field: scales.SystemDeltaLogScale
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: DeltaLogScale from related system_stats
-- Formula: =INDEX(system_stats!{{DeltaLogScale}}, MATCH(scales!{{System}}, system_stats!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_scales_system_delta_log_scale(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN calc_system_stats_delta_log_scale((SELECT "system" FROM scales WHERE scale_id = p_scale_id));
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_data_regime
-- Helper function: Get DataRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_data_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_scale_regime
-- Helper function: Get ScaleRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_scale_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT scale_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_type
-- Helper function: Get NoiseType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT noise_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_sigma
-- Helper function: Get NoiseSigma from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_sigma(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT noise_sigma FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_min_scale
-- Helper function: Get CutoffMinScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_min_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_min_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_max_scale
-- Helper function: Get CutoffMaxScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_max_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_max_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_type
-- Helper function: Get DiscretizationType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_param
-- Helper function: Get DiscretizationParam from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_param(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_param FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_analysis_name
-- Helper function: Get AnalysisName from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_analysis_name(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT analysis_name FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_status
-- Helper function: Get Status from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_status(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT status FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_analysis_name
-- Helper function: Get AnalysisName from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_analysis_name(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT analysis_name FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_status
-- Helper function: Get Status from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_status(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT status FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_analysis_name
-- Helper function: Get AnalysisName from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_analysis_name(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT analysis_name FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_status
-- Helper function: Get Status from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_status(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT status FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_analysis_name
-- Helper function: Get AnalysisName from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_analysis_name(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT analysis_name FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- get_system_stats_status
-- Helper function: Get Status from system_stats by SystemStatsID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_system_stats_status(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT status FROM system_stats WHERE system_stats_id = p_system_stats_id);
END;
$$ LANGUAGE plpgsql;

-- calc_scales_scale_factor_power
-- Field: scales.ScaleFactorPower
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =POWER({{ScaleFactor}}, {{Iteration}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =POWER({{ScaleFactor}}, {{Iteration}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scales_scale_factor_power(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (POWER(calc_scales_scale_factor(p_scale_id), (SELECT iteration FROM scales WHERE scale_id = p_scale_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scales_scale
-- Field: scales.Scale
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{BaseScale}} * {{ScaleFactorPower}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{BaseScale}} * {{ScaleFactorPower}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scales_scale(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_scales_base_scale(p_scale_id), 0))::numeric * (COALESCE(calc_scales_scale_factor_power(p_scale_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scales_log_scale
-- Field: scales.LogScale
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG10({{Scale}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG10({{Scale}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scales_log_scale(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (LOG10(calc_scales_scale(p_scale_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scales_log_measure
-- Field: scales.LogMeasure
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG10({{Measure}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG10({{Measure}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scales_log_measure(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (LOG10((SELECT measure FROM scales WHERE scale_id = p_scale_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scales_scale_ratio
-- Field: scales.ScaleRatio
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{Scale}} / NULLIF({{BaseScale}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{Scale}} / NULLIF({{BaseScale}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scales_scale_ratio(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_scales_log_scale_normalized
-- Field: scales.LogScaleNormalized
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =({{LogScale}} - {{SystemMinLogScale}}) / NULLIF({{SystemDeltaLogScale}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =({{LogScale}} - {{SystemMinLogScale}}) / NULLIF({{SystemDeltaLogScale}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scales_log_scale_normalized(p_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_system_display_name
-- Field: system_stats.SystemDisplayName
-- Type: lookup | DataType: string | Returns: TEXT
-- Lookup: DisplayName from related systems
-- Formula: =INDEX(systems!{{DisplayName}}, MATCH(system_stats!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_system_stats_system_display_name(p_system_stats_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name::text FROM systems WHERE system_id = (SELECT "system" FROM system_stats WHERE system_stats_id = p_system_stats_id));
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_theoretical_log_log_slope
-- Field: system_stats.TheoreticalLogLogSlope
-- Type: lookup | DataType: decimal | Returns: NUMERIC
-- Lookup: TheoreticalLogLogSlope from related systems
-- Formula: =INDEX(systems!{{TheoreticalLogLogSlope}}, MATCH(system_stats!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_system_stats_theoretical_log_log_slope(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope::numeric FROM systems WHERE system_id = (SELECT "system" FROM system_stats WHERE system_stats_id = p_system_stats_id));
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_fitted_slope
-- Field: system_stats.FittedSlope
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: FittedSlope from related inference_runs
-- Formula: =INDEX(inference_runs!{{FittedSlope}}, MATCH(system_stats!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_system_stats_fitted_slope(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM system_stats WHERE system_stats_id = p_system_stats_id));
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_r2
-- Field: system_stats.R2
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: R2 from related inference_runs
-- Formula: =INDEX(inference_runs!{{R2}}, MATCH(system_stats!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_system_stats_r2(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM system_stats WHERE system_stats_id = p_system_stats_id));
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_residual_rms
-- Field: system_stats.ResidualRMS
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: ResidualRMS from related inference_runs
-- Formula: =INDEX(inference_runs!{{ResidualRMS}}, MATCH(system_stats!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_system_stats_residual_rms(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM system_stats WHERE system_stats_id = p_system_stats_id));
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_noise_sigma
-- Field: system_stats.NoiseSigma
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: NoiseSigma from related measurement_models
-- Formula: =INDEX(measurement_models!{{NoiseSigma}}, MATCH(system_stats!{{System}}, measurement_models!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_system_stats_noise_sigma(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT noise_sigma::numeric FROM measurement_models WHERE measurement_model_id = (SELECT "system" FROM system_stats WHERE system_stats_id = p_system_stats_id));
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_deviation_score
-- Field: system_stats.DeviationScore
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: DeviationScore from related inference_runs
-- Formula: =INDEX(inference_runs!{{DeviationScore}}, MATCH(system_stats!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_system_stats_deviation_score(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM system_stats WHERE system_stats_id = p_system_stats_id));
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_data_regime
-- Helper function: Get DataRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_data_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_scale_regime
-- Helper function: Get ScaleRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_scale_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT scale_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_type
-- Helper function: Get NoiseType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT noise_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_sigma
-- Helper function: Get NoiseSigma from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_sigma(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT noise_sigma FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_min_scale
-- Helper function: Get CutoffMinScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_min_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_min_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_max_scale
-- Helper function: Get CutoffMaxScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_max_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_max_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_type
-- Helper function: Get DiscretizationType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_param
-- Helper function: Get DiscretizationParam from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_param(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_param FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_point_count
-- Field: system_stats.PointCount
-- Type: aggregation | DataType: integer | Returns: INTEGER
-- Formula: =COUNTIF(scales!{{System}}, {{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =COUNTIF(scales!{{System}}, {{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_point_count(p_system_stats_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN ((SELECT COUNT(*) FROM scales WHERE "system" = (SELECT NULLIF("system", '') FROM system_stats WHERE system_stats_id = p_system_stats_id)))::integer;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_min_log_scale
-- Field: system_stats.MinLogScale
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MINIFS(scales!{{LogScale}}, scales!{{System}}, {{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MINIFS(scales!{{LogScale}}, scales!{{System}}, {{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_min_log_scale(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MIN(calc_scales_log_scale(scale_id)), 0) FROM scales WHERE "system" = (SELECT NULLIF("system", '') FROM system_stats WHERE system_stats_id = p_system_stats_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_max_log_scale
-- Field: system_stats.MaxLogScale
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MAXIFS(scales!{{LogScale}}, scales!{{System}}, {{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MAXIFS(scales!{{LogScale}}, scales!{{System}}, {{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_max_log_scale(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MAX(calc_scales_log_scale(scale_id)), 0) FROM scales WHERE "system" = (SELECT NULLIF("system", '') FROM system_stats WHERE system_stats_id = p_system_stats_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_min_log_measure
-- Field: system_stats.MinLogMeasure
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MINIFS(scales!{{LogMeasure}}, scales!{{System}}, {{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MINIFS(scales!{{LogMeasure}}, scales!{{System}}, {{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_min_log_measure(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MIN(calc_scales_log_measure(scale_id)), 0) FROM scales WHERE "system" = (SELECT NULLIF("system", '') FROM system_stats WHERE system_stats_id = p_system_stats_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_max_log_measure
-- Field: system_stats.MaxLogMeasure
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MAXIFS(scales!{{LogMeasure}}, scales!{{System}}, {{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MAXIFS(scales!{{LogMeasure}}, scales!{{System}}, {{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_max_log_measure(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MAX(calc_scales_log_measure(scale_id)), 0) FROM scales WHERE "system" = (SELECT NULLIF("system", '') FROM system_stats WHERE system_stats_id = p_system_stats_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_delta_log_measure
-- Field: system_stats.DeltaLogMeasure
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{MinLogMeasure}} - {{MaxLogMeasure}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{MinLogMeasure}} - {{MaxLogMeasure}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_delta_log_measure(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_system_stats_min_log_measure(p_system_stats_id), 0))::numeric - (COALESCE(calc_system_stats_max_log_measure(p_system_stats_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_delta_log_scale
-- Field: system_stats.DeltaLogScale
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{MaxLogScale}} - {{MinLogScale}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{MaxLogScale}} - {{MinLogScale}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_delta_log_scale(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_system_stats_max_log_scale(p_system_stats_id), 0))::numeric - (COALESCE(calc_system_stats_min_log_scale(p_system_stats_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_empirical_log_log_slope
-- Field: system_stats.EmpiricalLogLogSlope
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{DeltaLogMeasure}} / NULLIF({{DeltaLogScale}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{DeltaLogMeasure}} / NULLIF({{DeltaLogScale}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_empirical_log_log_slope(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_slope_error
-- Field: system_stats.SlopeError
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{EmpiricalLogLogSlope}} - {{TheoreticalLogLogSlope}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{EmpiricalLogLogSlope}} - {{TheoreticalLogLogSlope}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_slope_error(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_system_stats_empirical_log_log_slope(p_system_stats_id), 0))::numeric - (COALESCE(calc_system_stats_theoretical_log_log_slope(p_system_stats_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_fitted_vs_empirical_delta
-- Field: system_stats.FittedVsEmpiricalDelta
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{FittedSlope}} - {{EmpiricalLogLogSlope}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{FittedSlope}} - {{EmpiricalLogLogSlope}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_fitted_vs_empirical_delta(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_system_stats_fitted_slope(p_system_stats_id), 0))::numeric - (COALESCE(calc_system_stats_empirical_log_log_slope(p_system_stats_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_quality_weighted_slope
-- Field: system_stats.QualityWeightedSlope
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{R2}} * {{FittedSlope}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{R2}} * {{FittedSlope}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_quality_weighted_slope(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_system_stats_r2(p_system_stats_id), 0))::numeric * (COALESCE(calc_system_stats_fitted_slope(p_system_stats_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_slope_to_noise_ratio
-- Field: system_stats.SlopeToNoiseRatio
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =ABS({{EmpiricalLogLogSlope}}) / NULLIF({{NoiseSigma}}, 0)
-- WARNING: Formula translation failed: Function 'ABS' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =ABS({{EmpiricalLogLogSlope}}) / NULLIF({{NoiseSigma}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_slope_to_noise_ratio(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_abs_delta_log_measure
-- Field: system_stats.AbsDeltaLogMeasure
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =ABS({{DeltaLogMeasure}})
-- WARNING: Formula translation failed: Function 'ABS' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =ABS({{DeltaLogMeasure}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_abs_delta_log_measure(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_log_log_area
-- Field: system_stats.LogLogArea
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{DeltaLogScale}} * {{AbsDeltaLogMeasure}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{DeltaLogScale}} * {{AbsDeltaLogMeasure}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_log_log_area(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_system_stats_delta_log_scale(p_system_stats_id), 0))::numeric * (COALESCE(calc_system_stats_abs_delta_log_measure(p_system_stats_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_data_density
-- Field: system_stats.DataDensity
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{PointCount}} / NULLIF({{LogLogArea}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{PointCount}} / NULLIF({{LogLogArea}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_data_density(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_system_stats_relative_slope_error
-- Field: system_stats.RelativeSlopeError
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{SlopeError}} / NULLIF({{TheoreticalLogLogSlope}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{SlopeError}} / NULLIF({{TheoreticalLogLogSlope}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_system_stats_relative_slope_error(p_system_stats_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_residual_rmsfrom_inference
-- Field: measurement_models.ResidualRMSFromInference
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: ResidualRMS from related inference_runs
-- Formula: =INDEX(inference_runs!{{ResidualRMS}}, MATCH(measurement_models!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_measurement_models_residual_rmsfrom_inference(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM measurement_models WHERE measurement_model_id = p_measurement_model_id));
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_mean_absolute_residual
-- Field: measurement_models.MeanAbsoluteResidual
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =AVERAGEIFS(observed_scales!{{AbsResidual}}, observed_scales!{{MeasurementModel}}, measurement_models!{{MeasurementModelID}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =AVERAGEIFS(observed_scales!{{AbsResidual}}, observed_scales!{{MeasurementModel}}, measurement_models!{{MeasurementModelID}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_mean_absolute_residual(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(AVG(calc_observed_scales_abs_residual(observed_scale_id)), 0) FROM observed_scales WHERE measurement_model = p_measurement_model_id))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_outlier_count
-- Field: measurement_models.OutlierCount
-- Type: aggregation | DataType: integer | Returns: INTEGER
-- Formula: =COUNTIFS(observed_scales!{{MeasurementModel}}, measurement_models!{{MeasurementModelID}}, observed_scales!{{IsOutlier}}, TRUE)
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =COUNTIFS(observed_scales!{{MeasurementModel}}, measurement_models!{{MeasurementModelID}}, observed_scales!{{IsOutlier}}, TRUE)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_outlier_count(p_measurement_model_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN ((SELECT COUNT(*) FROM observed_scales WHERE measurement_model = (SELECT NULLIF(measurement_model_id, '') FROM measurement_models WHERE measurement_model_id = p_measurement_model_id)))::integer;
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_total_point_count
-- Field: measurement_models.TotalPointCount
-- Type: aggregation | DataType: integer | Returns: INTEGER
-- Formula: =COUNTIFS(observed_scales!{{MeasurementModel}}, measurement_models!{{MeasurementModelID}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =COUNTIFS(observed_scales!{{MeasurementModel}}, measurement_models!{{MeasurementModelID}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_total_point_count(p_measurement_model_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN ((SELECT COUNT(*) FROM observed_scales WHERE measurement_model = (SELECT NULLIF(measurement_model_id, '') FROM measurement_models WHERE measurement_model_id = p_measurement_model_id)))::integer;
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_outlier_rate
-- Field: measurement_models.OutlierRate
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{OutlierCount}} / NULLIF({{TotalPointCount}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{OutlierCount}} / NULLIF({{TotalPointCount}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_outlier_rate(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_effective_point_count
-- Field: measurement_models.EffectivePointCount
-- Type: calculated | DataType: integer | Returns: INTEGER
-- Formula: ={{TotalPointCount}} - {{OutlierCount}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{TotalPointCount}} - {{OutlierCount}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_effective_point_count(p_measurement_model_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (((COALESCE(calc_measurement_models_total_point_count(p_measurement_model_id), 0))::numeric - (COALESCE(calc_measurement_models_outlier_count(p_measurement_model_id), 0))::numeric))::integer;
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_cutoff_log_min_scale
-- Field: measurement_models.CutoffLogMinScale
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG10({{CutoffMinScale}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG10({{CutoffMinScale}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_cutoff_log_min_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (LOG10((SELECT cutoff_min_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_cutoff_log_max_scale
-- Field: measurement_models.CutoffLogMaxScale
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG10({{CutoffMaxScale}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG10({{CutoffMaxScale}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_cutoff_log_max_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (LOG10((SELECT cutoff_max_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_measurement_models_cutoff_range_span
-- Field: measurement_models.CutoffRangeSpan
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{CutoffLogMaxScale}} - {{CutoffLogMinScale}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{CutoffLogMaxScale}} - {{CutoffLogMinScale}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_measurement_models_cutoff_range_span(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_measurement_models_cutoff_log_max_scale(p_measurement_model_id), 0))::numeric - (COALESCE(calc_measurement_models_cutoff_log_min_scale(p_measurement_model_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_base_scale
-- Field: observed_scales.BaseScale
-- Type: lookup | DataType: integer | Returns: INTEGER
-- Lookup: BaseScale from related systems
-- Formula: =INDEX(systems!{{BaseScale}}, MATCH(observed_scales!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_observed_scales_base_scale(p_observed_scale_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale::integer FROM systems WHERE system_id = (SELECT "system" FROM observed_scales WHERE observed_scale_id = p_observed_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_scale_factor
-- Field: observed_scales.ScaleFactor
-- Type: lookup | DataType: decimal | Returns: NUMERIC
-- Lookup: ScaleFactor from related systems
-- Formula: =INDEX(systems!{{ScaleFactor}}, MATCH(observed_scales!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_observed_scales_scale_factor(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor::numeric FROM systems WHERE system_id = (SELECT "system" FROM observed_scales WHERE observed_scale_id = p_observed_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_fitted_slope
-- Field: observed_scales.FittedSlope
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: FittedSlope from related inference_runs
-- Formula: =INDEX(inference_runs!{{FittedSlope}}, MATCH(observed_scales!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_observed_scales_fitted_slope(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM observed_scales WHERE observed_scale_id = p_observed_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_fitted_intercept
-- Field: observed_scales.FittedIntercept
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: FittedIntercept from related inference_runs
-- Formula: =INDEX(inference_runs!{{FittedIntercept}}, MATCH(observed_scales!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_observed_scales_fitted_intercept(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM observed_scales WHERE observed_scale_id = p_observed_scale_id));
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_residual_rms
-- Field: observed_scales.ResidualRMS
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: ResidualRMS from related inference_runs
-- Formula: =INDEX(inference_runs!{{ResidualRMS}}, MATCH(observed_scales!{{System}}, inference_runs!{{System}}, 0))
CREATE OR REPLACE FUNCTION calc_observed_scales_residual_rms(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms::numeric FROM inference_runs WHERE inference_run_id = (SELECT "system" FROM observed_scales WHERE observed_scale_id = p_observed_scale_id));
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_data_regime
-- Helper function: Get DataRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_data_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_scale_regime
-- Helper function: Get ScaleRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_scale_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT scale_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_type
-- Helper function: Get NoiseType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT noise_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_sigma
-- Helper function: Get NoiseSigma from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_sigma(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT noise_sigma FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_min_scale
-- Helper function: Get CutoffMinScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_min_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_min_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_max_scale
-- Helper function: Get CutoffMaxScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_max_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_max_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_type
-- Helper function: Get DiscretizationType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_param
-- Helper function: Get DiscretizationParam from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_param(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_param FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_data_regime
-- Helper function: Get DataRegime from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_data_regime(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fit_method
-- Helper function: Get FitMethod from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fit_method(p_inference_run_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT fit_method FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_point_count
-- Helper function: Get PointCount from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_point_count(p_inference_run_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_theoretical_log_log_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_slope
-- Helper function: Get FittedSlope from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_slope(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_slope FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_fitted_intercept
-- Helper function: Get FittedIntercept from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_fitted_intercept(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fitted_intercept FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_slope_delta
-- Helper function: Get SlopeDelta from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT slope_delta FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_r2
-- Helper function: Get R2 from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_rms
-- Helper function: Get ResidualRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_residual_max_abs
-- Helper function: Get ResidualMaxAbs from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_residual_max_abs(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT residual_max_abs FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_orthogonal_rms
-- Helper function: Get OrthogonalRMS from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_orthogonal_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT orthogonal_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- get_inference_runs_deviation_score
-- Helper function: Get DeviationScore from inference_runs by InferenceRunID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_inference_runs_deviation_score(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT deviation_score FROM inference_runs WHERE inference_run_id = p_inference_run_id);
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_scale_factor_power
-- Field: observed_scales.ScaleFactorPower
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =POWER({{ScaleFactor}}, {{Iteration}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =POWER({{ScaleFactor}}, {{Iteration}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_scale_factor_power(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (POWER(calc_observed_scales_scale_factor(p_observed_scale_id), (SELECT iteration FROM observed_scales WHERE observed_scale_id = p_observed_scale_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_scale
-- Field: observed_scales.Scale
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{BaseScale}} * {{ScaleFactorPower}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{BaseScale}} * {{ScaleFactorPower}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_scale(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_observed_scales_base_scale(p_observed_scale_id), 0))::numeric * (COALESCE(calc_observed_scales_scale_factor_power(p_observed_scale_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_log_scale
-- Field: observed_scales.LogScale
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG10({{Scale}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG10({{Scale}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_log_scale(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (LOG10(calc_observed_scales_scale(p_observed_scale_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_log_measure
-- Field: observed_scales.LogMeasure
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG10({{Measure}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG10({{Measure}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_log_measure(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (LOG10((SELECT measure FROM observed_scales WHERE observed_scale_id = p_observed_scale_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_predicted_log_measure
-- Field: observed_scales.PredictedLogMeasure
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{FittedSlope}} * {{LogScale}} + {{FittedIntercept}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{FittedSlope}} * {{LogScale}} + {{FittedIntercept}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_predicted_log_measure(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(((COALESCE(calc_observed_scales_fitted_slope(p_observed_scale_id), 0))::numeric * (COALESCE(calc_observed_scales_log_scale(p_observed_scale_id), 0))::numeric), 0))::numeric + (COALESCE(calc_observed_scales_fitted_intercept(p_observed_scale_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_residual
-- Field: observed_scales.Residual
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{LogMeasure}} - {{PredictedLogMeasure}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{LogMeasure}} - {{PredictedLogMeasure}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_residual(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_observed_scales_log_measure(p_observed_scale_id), 0))::numeric - (COALESCE(calc_observed_scales_predicted_log_measure(p_observed_scale_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_residual_squared
-- Field: observed_scales.ResidualSquared
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{Residual}} * {{Residual}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{Residual}} * {{Residual}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_residual_squared(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_observed_scales_residual(p_observed_scale_id), 0))::numeric * (COALESCE(calc_observed_scales_residual(p_observed_scale_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_standardized_residual
-- Field: observed_scales.StandardizedResidual
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{Residual}} / NULLIF({{ResidualRMS}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{Residual}} / NULLIF({{ResidualRMS}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_standardized_residual(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_is_outlier
-- Field: observed_scales.IsOutlier
-- Type: calculated | DataType: boolean | Returns: BOOLEAN
-- Formula: =ABS({{StandardizedResidual}}) > 2.5
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =ABS({{StandardizedResidual}}) > 2.5
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_is_outlier(p_observed_scale_id TEXT)
RETURNS BOOLEAN AS $$
BEGIN
  RETURN (ABS(calc_observed_scales_standardized_residual(p_observed_scale_id)) > 2.5)::text;
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_scale_ratio
-- Field: observed_scales.ScaleRatio
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{Scale}} / NULLIF({{BaseScale}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{Scale}} / NULLIF({{BaseScale}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_scale_ratio(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_observed_scales_abs_residual
-- Field: observed_scales.AbsResidual
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =ABS({{Residual}})
-- WARNING: Formula translation failed: Function 'ABS' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =ABS({{Residual}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_observed_scales_abs_residual(p_observed_scale_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_data_regime
-- Helper function: Get DataRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_data_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT data_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_scale_regime
-- Helper function: Get ScaleRegime from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_scale_regime(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT scale_regime FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_type
-- Helper function: Get NoiseType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT noise_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_noise_sigma
-- Helper function: Get NoiseSigma from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_noise_sigma(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT noise_sigma FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_min_scale
-- Helper function: Get CutoffMinScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_min_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_min_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_cutoff_max_scale
-- Helper function: Get CutoffMaxScale from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_cutoff_max_scale(p_measurement_model_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT cutoff_max_scale FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_type
-- Helper function: Get DiscretizationType from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_type(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_type FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- get_measurement_models_discretization_param
-- Helper function: Get DiscretizationParam from measurement_models by MeasurementModelID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_measurement_models_discretization_param(p_measurement_model_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT discretization_param FROM measurement_models WHERE measurement_model_id = p_measurement_model_id);
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_slope_confidence_interval
-- Field: inference_runs.SlopeConfidenceInterval
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =1.96 * ({{ResidualRMS}} / NULLIF(SQRT({{PointCount}}), 0))
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =1.96 * ({{ResidualRMS}} / NULLIF(SQRT({{PointCount}}), 0))
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_slope_confidence_interval(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(1.96, 0))::numeric * (COALESCE(((SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id) / NULLIF(SQRT((SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id)), 0)), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_min_log_scale
-- Field: inference_runs.MinLogScale
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MINIFS(observed_scales!{{LogScale}}, observed_scales!{{System}}, inference_runs!{{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MINIFS(observed_scales!{{LogScale}}, observed_scales!{{System}}, inference_runs!{{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_min_log_scale(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MIN(calc_observed_scales_log_scale(observed_scale_id)), 0) FROM observed_scales WHERE "system" = (SELECT NULLIF("system", '') FROM inference_runs WHERE inference_run_id = p_inference_run_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_max_log_scale
-- Field: inference_runs.MaxLogScale
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MAXIFS(observed_scales!{{LogScale}}, observed_scales!{{System}}, inference_runs!{{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MAXIFS(observed_scales!{{LogScale}}, observed_scales!{{System}}, inference_runs!{{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_max_log_scale(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MAX(calc_observed_scales_log_scale(observed_scale_id)), 0) FROM observed_scales WHERE "system" = (SELECT NULLIF("system", '') FROM inference_runs WHERE inference_run_id = p_inference_run_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_min_log_measure
-- Field: inference_runs.MinLogMeasure
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MINIFS(observed_scales!{{LogMeasure}}, observed_scales!{{System}}, inference_runs!{{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MINIFS(observed_scales!{{LogMeasure}}, observed_scales!{{System}}, inference_runs!{{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_min_log_measure(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MIN(calc_observed_scales_log_measure(observed_scale_id)), 0) FROM observed_scales WHERE "system" = (SELECT NULLIF("system", '') FROM inference_runs WHERE inference_run_id = p_inference_run_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_max_log_measure
-- Field: inference_runs.MaxLogMeasure
-- Type: aggregation | DataType: number | Returns: NUMERIC
-- Formula: =MAXIFS(observed_scales!{{LogMeasure}}, observed_scales!{{System}}, inference_runs!{{System}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =MAXIFS(observed_scales!{{LogMeasure}}, observed_scales!{{System}}, inference_runs!{{System}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_max_log_measure(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN ((SELECT COALESCE(MAX(calc_observed_scales_log_measure(observed_scale_id)), 0) FROM observed_scales WHERE "system" = (SELECT NULLIF("system", '') FROM inference_runs WHERE inference_run_id = p_inference_run_id)))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_log_measure_range
-- Field: inference_runs.LogMeasureRange
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{MaxLogMeasure}} - {{MinLogMeasure}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{MaxLogMeasure}} - {{MinLogMeasure}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_log_measure_range(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(calc_inference_runs_max_log_measure(p_inference_run_id), 0))::numeric - (COALESCE(calc_inference_runs_min_log_measure(p_inference_run_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_abs_slope_delta
-- Field: inference_runs.AbsSlopeDelta
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =ABS({{SlopeDelta}})
-- WARNING: Formula translation failed: Function 'ABS' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =ABS({{SlopeDelta}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_abs_slope_delta(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_slope_is_significant
-- Field: inference_runs.SlopeIsSignificant
-- Type: calculated | DataType: boolean | Returns: BOOLEAN
-- Formula: ={{AbsSlopeDelta}} > {{SlopeConfidenceInterval}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{AbsSlopeDelta}} > {{SlopeConfidenceInterval}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_slope_is_significant(p_inference_run_id TEXT)
RETURNS BOOLEAN AS $$
BEGIN
  RETURN (calc_inference_runs_abs_slope_delta(p_inference_run_id) > calc_inference_runs_slope_confidence_interval(p_inference_run_id))::text;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_one_plus_residual_rms
-- Field: inference_runs.OnePlusResidualRMS
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =1 + {{ResidualRMS}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =1 + {{ResidualRMS}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_one_plus_residual_rms(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(1, 0))::numeric + (COALESCE((SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_fit_efficiency
-- Field: inference_runs.FitEfficiency
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{R2}} / NULLIF({{OnePlusResidualRMS}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{R2}} / NULLIF({{OnePlusResidualRMS}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_fit_efficiency(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_normalized_rmse
-- Field: inference_runs.NormalizedRMSE
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{ResidualRMS}} / NULLIF({{LogMeasureRange}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{ResidualRMS}} / NULLIF({{LogMeasureRange}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_normalized_rmse(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_slope_to_theoretical_ratio
-- Field: inference_runs.SlopeToTheoreticalRatio
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{FittedSlope}} / NULLIF({{TheoreticalLogLogSlope}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{FittedSlope}} / NULLIF({{TheoreticalLogLogSlope}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_slope_to_theoretical_ratio(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_one_minus_r2
-- Field: inference_runs.OneMinusR2
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =1 - {{R2}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =1 - {{R2}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_one_minus_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(1, 0))::numeric - (COALESCE((SELECT r2 FROM inference_runs WHERE inference_run_id = p_inference_run_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_point_count_minus_one
-- Field: inference_runs.PointCountMinusOne
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{PointCount}} - 1
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{PointCount}} - 1
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_point_count_minus_one(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE((SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id), 0))::numeric - (COALESCE(1, 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_point_count_minus_two
-- Field: inference_runs.PointCountMinusTwo
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{PointCount}} - 2
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{PointCount}} - 2
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_point_count_minus_two(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE((SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id), 0))::numeric - (COALESCE(2, 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_adjusted_r2
-- Field: inference_runs.AdjustedR2
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =1 - {{OneMinusR2}} * {{PointCountMinusOne}} / NULLIF({{PointCountMinusTwo}}, 0)
-- WARNING: Formula translation failed: Function 'NULLIF' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =1 - {{OneMinusR2}} * {{PointCountMinusOne}} / NULLIF({{PointCountMinusTwo}}, 0)
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_adjusted_r2(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_residual_rmssquared
-- Field: inference_runs.ResidualRMSSquared
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{ResidualRMS}} * {{ResidualRMS}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{ResidualRMS}} * {{ResidualRMS}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_residual_rmssquared(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE((SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id), 0))::numeric * (COALESCE((SELECT residual_rms FROM inference_runs WHERE inference_run_id = p_inference_run_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_log_residual_rmssquared
-- Field: inference_runs.LogResidualRMSSquared
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG({{ResidualRMSSquared}})
-- WARNING: Formula translation failed: Function 'LOG' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG({{ResidualRMSSquared}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_log_residual_rmssquared(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_log_point_count
-- Field: inference_runs.LogPointCount
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =LOG({{PointCount}})
-- WARNING: Formula translation failed: Function 'LOG' is not supported yet
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =LOG({{PointCount}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_log_point_count(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN NULL; -- Formula translation failed
END;
$$ LANGUAGE plpgsql;

-- calc_inference_runs_bic
-- Field: inference_runs.BIC
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{PointCount}} * {{LogResidualRMSSquared}} + 2 * {{LogPointCount}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{PointCount}} * {{LogResidualRMSSquared}} + 2 * {{LogPointCount}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_inference_runs_bic(p_inference_run_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(((COALESCE((SELECT point_count FROM inference_runs WHERE inference_run_id = p_inference_run_id), 0))::numeric * (COALESCE(calc_inference_runs_log_residual_rmssquared(p_inference_run_id), 0))::numeric), 0))::numeric + (COALESCE(((COALESCE(2, 0))::numeric * (COALESCE(calc_inference_runs_log_point_count(p_inference_run_id), 0))::numeric), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scale_regimes_theoretical_log_log_slope
-- Field: scale_regimes.TheoreticalLogLogSlope
-- Type: lookup | DataType: number | Returns: NUMERIC
-- Lookup: TheoreticalLogLogSlope from related systems
-- Formula: =INDEX(systems!{{TheoreticalLogLogSlope}}, MATCH(scale_regimes!{{System}}, systems!{{SystemID}}, 0))
CREATE OR REPLACE FUNCTION calc_scale_regimes_theoretical_log_log_slope(p_regime_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope::numeric FROM systems WHERE system_id = (SELECT "system" FROM scale_regimes WHERE regime_id = p_regime_id));
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_display_name
-- Helper function: Get DisplayName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_display_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT display_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_class
-- Helper function: Get Class from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_class(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT class FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_base_scale
-- Helper function: Get BaseScale from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_base_scale(p_system_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN (SELECT base_scale FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_scale_factor
-- Helper function: Get ScaleFactor from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_scale_factor(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT scale_factor FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_measure_name
-- Helper function: Get MeasureName from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_measure_name(p_system_id TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN (SELECT measure_name FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_fractal_dimension
-- Helper function: Get FractalDimension from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_fractal_dimension(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT fractal_dimension FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- get_systems_theoretical_log_log_slope
-- Helper function: Get TheoreticalLogLogSlope from systems by SystemID
-- Used for join-free cross-table references in aggregations
CREATE OR REPLACE FUNCTION get_systems_theoretical_log_log_slope(p_system_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT theoretical_log_log_slope FROM systems WHERE system_id = p_system_id);
END;
$$ LANGUAGE plpgsql;

-- calc_scale_regimes_regime_span
-- Field: scale_regimes.RegimeSpan
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{MaxLogScale}} - {{MinLogScale}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{MaxLogScale}} - {{MinLogScale}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scale_regimes_regime_span(p_regime_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE((SELECT max_log_scale FROM scale_regimes WHERE regime_id = p_regime_id), 0))::numeric - (COALESCE((SELECT min_log_scale FROM scale_regimes WHERE regime_id = p_regime_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scale_regimes_regime_center
-- Field: scale_regimes.RegimeCenter
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: =({{MinLogScale}} + {{MaxLogScale}}) / 2
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =({{MinLogScale}} + {{MaxLogScale}}) / 2
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scale_regimes_regime_center(p_regime_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE(((SELECT min_log_scale FROM scale_regimes WHERE regime_id = p_regime_id) + (SELECT max_log_scale FROM scale_regimes WHERE regime_id = p_regime_id)), 0))::numeric / (COALESCE(2, 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scale_regimes_slope_deviation_from_global
-- Field: scale_regimes.SlopeDeviationFromGlobal
-- Type: calculated | DataType: number | Returns: NUMERIC
-- Formula: ={{ExpectedSlope}} - {{TheoreticalLogLogSlope}}
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: ={{ExpectedSlope}} - {{TheoreticalLogLogSlope}}
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scale_regimes_slope_deviation_from_global(p_regime_id TEXT)
RETURNS NUMERIC AS $$
BEGIN
  RETURN (((COALESCE((SELECT expected_slope FROM scale_regimes WHERE regime_id = p_regime_id), 0))::numeric - (COALESCE(calc_scale_regimes_theoretical_log_log_slope(p_regime_id), 0))::numeric))::numeric;
END;
$$ LANGUAGE plpgsql;

-- calc_scale_regimes_points_in_regime
-- Field: scale_regimes.PointsInRegime
-- Type: aggregation | DataType: integer | Returns: INTEGER
-- Formula: =COUNTIFS(scales!{{System}}, scale_regimes!{{System}}, scales!{{LogScale}}, ">="&scale_regimes!{{MinLogScale}}, scales!{{LogScale}}, "<="&scale_regimes!{{MaxLogScale}})
-- ============================================================================
-- CRITICAL FUNCTION VALIDATION CODE - DO NOT REMOVE
-- Original Excel Formula: =COUNTIFS(scales!{{System}}, scale_regimes!{{System}}, scales!{{LogScale}}, ">="&scale_regimes!{{MinLogScale}}, scales!{{LogScale}}, "<="&scale_regimes!{{MaxLogScale}})
-- This formula is preserved for validation and debugging purposes
-- ============================================================================
CREATE OR REPLACE FUNCTION calc_scale_regimes_points_in_regime(p_regime_id TEXT)
RETURNS INTEGER AS $$
BEGIN
  RETURN ((SELECT COUNT(*) FROM scales WHERE "system" = (SELECT NULLIF("system", '') FROM scale_regimes WHERE regime_id = p_regime_id)))::integer;
END;
$$ LANGUAGE plpgsql;

