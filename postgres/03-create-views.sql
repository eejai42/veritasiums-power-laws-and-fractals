-- ============================================================================
-- CREATE VIEWS - Combine raw data with calculated fields
-- ============================================================================
-- Generated by rulebook-to-postgres tool
-- Total Views: 7
-- ============================================================================

-- systems View
-- Includes all base table columns (raw + FK) for updatable view support
CREATE OR REPLACE VIEW vw_systems AS
SELECT
  t.system_id,
  t.display_name,
  t.class,
  t.base_scale,
  t.scale_factor,
  t.measure_name,
  t.fractal_dimension,
  t.theoretical_log_log_slope,
  calc_systems_empirical_fit_quality(t.system_id) AS empirical_fit_quality,
  calc_systems_empirical_slope_deviation(t.system_id) AS empirical_slope_deviation,
  calc_systems_measurement_noise_level(t.system_id) AS measurement_noise_level,
  calc_systems_relative_slope_error(t.system_id) AS relative_slope_error,
  calc_systems_scale_range_span(t.system_id) AS scale_range_span,
  calc_systems_measure_range_span(t.system_id) AS measure_range_span,
  calc_systems_data_quality_score(t.system_id) AS data_quality_score,
  calc_systems_is_high_quality_fit(t.system_id) AS is_high_quality_fit
FROM systems t;

-- scales View
-- Includes all base table columns (raw + FK) for updatable view support
CREATE OR REPLACE VIEW vw_scales AS
SELECT
  t.scale_id,
  t."system",
  t.iteration,
  t.measure,
  t.is_projected,
  t.data_regime,
  t.measurement_model,
  calc_scales_base_scale(t.scale_id) AS base_scale,
  calc_scales_scale_factor(t.scale_id) AS scale_factor,
  calc_scales_theoretical_log_log_slope(t.scale_id) AS theoretical_log_log_slope,
  calc_scales_empirical_log_log_slope(t.scale_id) AS empirical_log_log_slope,
  calc_scales_system_min_log_scale(t.scale_id) AS system_min_log_scale,
  calc_scales_system_max_log_scale(t.scale_id) AS system_max_log_scale,
  calc_scales_system_delta_log_scale(t.scale_id) AS system_delta_log_scale,
  calc_scales_scale_factor_power(t.scale_id) AS scale_factor_power,
  calc_scales_scale(t.scale_id) AS scale,
  calc_scales_log_scale(t.scale_id) AS log_scale,
  calc_scales_log_measure(t.scale_id) AS log_measure,
  calc_scales_scale_ratio(t.scale_id) AS scale_ratio,
  calc_scales_log_scale_normalized(t.scale_id) AS log_scale_normalized
FROM scales t;

-- system_stats View
-- Includes all base table columns (raw + FK) for updatable view support
CREATE OR REPLACE VIEW vw_system_stats AS
SELECT
  t.system_stats_id,
  t."system",
  t.analysis_name,
  t.status,
  calc_system_stats_system_display_name(t.system_stats_id) AS system_display_name,
  calc_system_stats_theoretical_log_log_slope(t.system_stats_id) AS theoretical_log_log_slope,
  calc_system_stats_fitted_slope(t.system_stats_id) AS fitted_slope,
  calc_system_stats_r2(t.system_stats_id) AS r2,
  calc_system_stats_residual_rms(t.system_stats_id) AS residual_rms,
  calc_system_stats_noise_sigma(t.system_stats_id) AS noise_sigma,
  calc_system_stats_deviation_score(t.system_stats_id) AS deviation_score,
  calc_system_stats_point_count(t.system_stats_id) AS point_count,
  calc_system_stats_min_log_scale(t.system_stats_id) AS min_log_scale,
  calc_system_stats_max_log_scale(t.system_stats_id) AS max_log_scale,
  calc_system_stats_min_log_measure(t.system_stats_id) AS min_log_measure,
  calc_system_stats_max_log_measure(t.system_stats_id) AS max_log_measure,
  calc_system_stats_delta_log_measure(t.system_stats_id) AS delta_log_measure,
  calc_system_stats_delta_log_scale(t.system_stats_id) AS delta_log_scale,
  calc_system_stats_empirical_log_log_slope(t.system_stats_id) AS empirical_log_log_slope,
  calc_system_stats_slope_error(t.system_stats_id) AS slope_error,
  calc_system_stats_fitted_vs_empirical_delta(t.system_stats_id) AS fitted_vs_empirical_delta,
  calc_system_stats_quality_weighted_slope(t.system_stats_id) AS quality_weighted_slope,
  calc_system_stats_slope_to_noise_ratio(t.system_stats_id) AS slope_to_noise_ratio,
  calc_system_stats_abs_delta_log_measure(t.system_stats_id) AS abs_delta_log_measure,
  calc_system_stats_log_log_area(t.system_stats_id) AS log_log_area,
  calc_system_stats_data_density(t.system_stats_id) AS data_density,
  calc_system_stats_relative_slope_error(t.system_stats_id) AS relative_slope_error
FROM system_stats t;

-- measurement_models View
-- Includes all base table columns (raw + FK) for updatable view support
CREATE OR REPLACE VIEW vw_measurement_models AS
SELECT
  t.measurement_model_id,
  t."system",
  t.data_regime,
  t.scale_regime,
  t.noise_type,
  t.noise_sigma,
  t.cutoff_min_scale,
  t.cutoff_max_scale,
  t.discretization_type,
  t.discretization_param,
  calc_measurement_models_residual_rmsfrom_inference(t.measurement_model_id) AS residual_rmsfrom_inference,
  calc_measurement_models_mean_absolute_residual(t.measurement_model_id) AS mean_absolute_residual,
  calc_measurement_models_outlier_count(t.measurement_model_id) AS outlier_count,
  calc_measurement_models_total_point_count(t.measurement_model_id) AS total_point_count,
  calc_measurement_models_outlier_rate(t.measurement_model_id) AS outlier_rate,
  calc_measurement_models_effective_point_count(t.measurement_model_id) AS effective_point_count,
  calc_measurement_models_cutoff_log_min_scale(t.measurement_model_id) AS cutoff_log_min_scale,
  calc_measurement_models_cutoff_log_max_scale(t.measurement_model_id) AS cutoff_log_max_scale,
  calc_measurement_models_cutoff_range_span(t.measurement_model_id) AS cutoff_range_span
FROM measurement_models t;

-- observed_scales View
-- Includes all base table columns (raw + FK) for updatable view support
CREATE OR REPLACE VIEW vw_observed_scales AS
SELECT
  t.observed_scale_id,
  t."system",
  t.measurement_model,
  t.iteration,
  t.measure,
  t.data_regime,
  calc_observed_scales_base_scale(t.observed_scale_id) AS base_scale,
  calc_observed_scales_scale_factor(t.observed_scale_id) AS scale_factor,
  calc_observed_scales_fitted_slope(t.observed_scale_id) AS fitted_slope,
  calc_observed_scales_fitted_intercept(t.observed_scale_id) AS fitted_intercept,
  calc_observed_scales_residual_rms(t.observed_scale_id) AS residual_rms,
  calc_observed_scales_scale_factor_power(t.observed_scale_id) AS scale_factor_power,
  calc_observed_scales_scale(t.observed_scale_id) AS scale,
  calc_observed_scales_log_scale(t.observed_scale_id) AS log_scale,
  calc_observed_scales_log_measure(t.observed_scale_id) AS log_measure,
  calc_observed_scales_predicted_log_measure(t.observed_scale_id) AS predicted_log_measure,
  calc_observed_scales_residual(t.observed_scale_id) AS residual,
  calc_observed_scales_residual_squared(t.observed_scale_id) AS residual_squared,
  calc_observed_scales_standardized_residual(t.observed_scale_id) AS standardized_residual,
  calc_observed_scales_is_outlier(t.observed_scale_id) AS is_outlier,
  calc_observed_scales_scale_ratio(t.observed_scale_id) AS scale_ratio,
  calc_observed_scales_abs_residual(t.observed_scale_id) AS abs_residual
FROM observed_scales t;

-- inference_runs View
-- Includes all base table columns (raw + FK) for updatable view support
CREATE OR REPLACE VIEW vw_inference_runs AS
SELECT
  t.inference_run_id,
  t."system",
  t.data_regime,
  t.measurement_model,
  t.fit_method,
  t.fitted_slope,
  t.fitted_intercept,
  t.r2,
  t.residual_rms,
  t.residual_max_abs,
  t.orthogonal_rms,
  calc_inference_runs_theoretical_log_log_slope(t.inference_run_id) AS theoretical_log_log_slope,
  calc_inference_runs_point_count(t.inference_run_id) AS point_count,
  calc_inference_runs_slope_delta(t.inference_run_id) AS slope_delta,
  calc_inference_runs_deviation_score(t.inference_run_id) AS deviation_score,
  calc_inference_runs_slope_confidence_interval(t.inference_run_id) AS slope_confidence_interval,
  calc_inference_runs_min_log_scale(t.inference_run_id) AS min_log_scale,
  calc_inference_runs_max_log_scale(t.inference_run_id) AS max_log_scale,
  calc_inference_runs_min_log_measure(t.inference_run_id) AS min_log_measure,
  calc_inference_runs_max_log_measure(t.inference_run_id) AS max_log_measure,
  calc_inference_runs_log_measure_range(t.inference_run_id) AS log_measure_range,
  calc_inference_runs_abs_slope_delta(t.inference_run_id) AS abs_slope_delta,
  calc_inference_runs_slope_is_significant(t.inference_run_id) AS slope_is_significant,
  calc_inference_runs_one_plus_residual_rms(t.inference_run_id) AS one_plus_residual_rms,
  calc_inference_runs_fit_efficiency(t.inference_run_id) AS fit_efficiency,
  calc_inference_runs_normalized_rmse(t.inference_run_id) AS normalized_rmse,
  calc_inference_runs_slope_to_theoretical_ratio(t.inference_run_id) AS slope_to_theoretical_ratio,
  calc_inference_runs_one_minus_r2(t.inference_run_id) AS one_minus_r2,
  calc_inference_runs_point_count_minus_one(t.inference_run_id) AS point_count_minus_one,
  calc_inference_runs_point_count_minus_two(t.inference_run_id) AS point_count_minus_two,
  calc_inference_runs_adjusted_r2(t.inference_run_id) AS adjusted_r2,
  calc_inference_runs_residual_rmssquared(t.inference_run_id) AS residual_rmssquared,
  calc_inference_runs_log_residual_rmssquared(t.inference_run_id) AS log_residual_rmssquared,
  calc_inference_runs_log_point_count(t.inference_run_id) AS log_point_count,
  calc_inference_runs_bic(t.inference_run_id) AS bic
FROM inference_runs t;

-- scale_regimes View
-- Includes all base table columns (raw + FK) for updatable view support
CREATE OR REPLACE VIEW vw_scale_regimes AS
SELECT
  t.regime_id,
  t."system",
  t.min_log_scale,
  t.max_log_scale,
  t.expected_slope,
  t.regime_type,
  calc_scale_regimes_theoretical_log_log_slope(t.regime_id) AS theoretical_log_log_slope,
  calc_scale_regimes_regime_span(t.regime_id) AS regime_span,
  calc_scale_regimes_regime_center(t.regime_id) AS regime_center,
  calc_scale_regimes_slope_deviation_from_global(t.regime_id) AS slope_deviation_from_global,
  calc_scale_regimes_points_in_regime(t.regime_id) AS points_in_regime
FROM scale_regimes t;

